#!/usr/bin/env bash
set -e

STAGED_KT_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(kt|kts)$' || true)

if [ -z "$STAGED_KT_FILES" ]; then
    echo "No Kotlin files staged, skipping checks."
    exit 0
fi

echo "=== Spotless Check ==="
./gradlew spotlessCheck --daemon 2>&1

echo "=== Detekt ==="
./gradlew :composeApp:detektCommonMainSourceSet :composeApp:detektAndroidMainSourceSet :composeApp:detektDesktopMainSourceSet :composeApp:detektIosMainSourceSet --daemon 2>&1

echo "All pre-commit checks passed."
